<script>
  window.onload = async () => {
    const status = document.getElementById("status");

    try {
      // Wait for cheerpjInit to be defined
      let retries = 0;
      while (typeof cheerpjInit !== "function" && retries < 20) {
        await new Promise(res => setTimeout(res, 200));
        retries++;
      }

      if (typeof cheerpjInit !== "function") {
        status.textContent = "CheerpJ runtime failed to load.";
        return;
      }

      await cheerpjInit(); // IMPORTANT: Wait for runtime to fully initialize
      await cheerpjLoadJar("Audioscope-fixed.jar");
      await cheerpjRunMain("audioscope.StartScreen", []);

      status.textContent = "App launched!";
    } catch (err) {
      console.error("Runtime error:", err);
      status.textContent = "Launch failed: " + err.message;
    }
  };
</script>
