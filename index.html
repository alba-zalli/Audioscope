<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Audioscope Demo</title>
  <script src="https://cjrtnc.leaningtech.com/4.2/loader.js"></script>
</head>
<body>
  <h1>Audioscope</h1>
  <p id="status">Loading CheerpJ runtime...</p>

  <script>
    window.addEventListener("load", () => {
      const status = document.getElementById("status");

      function waitForCheerpJ(callback) {
        let retries = 0;
        const interval = setInterval(() => {
          if (typeof cheerpjInit === "function" && typeof cheerpjLoadJar === "function") {
            clearInterval(interval);
            callback();
          } else if (retries++ > 20) {
            clearInterval(interval);
            status.textContent = "‚ùå Failed to load CheerpJ runtime environment.";
          }
        }, 300);
      }

      waitForCheerpJ(() => {
        status.textContent = "‚úÖ CheerpJ loaded. Initializing...";

        cheerpjInit();

        setTimeout(() => {
          status.textContent = "üì¶ Loading JAR...";
          cheerpjLoadJar("Audioscope-fixed.jar").then(() => {
            status.textContent = "üöÄ Running main class...";
            cheerpjRunMain("audioscope.StartScreen", []);
            status.textContent = "‚úÖ Application launched!";
          }).catch((err) => {
            console.error(err);
            status.textContent = "‚ùå Error loading JAR: " + err.message;
          });
        }, 1000); // Wait a second after init
      });
    });
  </script>
</body>
</html>
